// Generated by CoffeeScript 1.8.0
(function() {
  var apiScheduleList, getSchedules, lastSchedules, rooms;
  console.log("background loaded");
  lastSchedules = [];
  rooms = {};
  apiScheduleList = "http://douyu.sashi-con.info/api/list";
  getSchedules = function() {
    var request;
    request = new XMLHttpRequest();
    request.open("GET", apiScheduleList, true);
    request.onload = function() {
      var s, scheduleHtml, schedules, _i, _len;
      if (request.status >= 200 && request.status < 400) {
        schedules = JSON.parse(request.responseText);
        scheduleHtml = '';
        for (_i = 0, _len = schedules.length; _i < _len; _i++) {
          s = schedules[_i];
          scheduleHtml += "<div class='schedule'>";
          scheduleHtml += "<div>";
          scheduleHtml += "<span class='time'>" + s.end + "</span><span class='channel'>" + s.begin + "</span>";
          scheduleHtml += "</div>";
          scheduleHtml += "<div>";
          scheduleHtml += "<span class='programm'>" + s.description + "</span>";
          scheduleHtml += "</div>";
        }
        chrome.browserAction.setBadgeText({
          text: " "
        });
        lastSchedules = schedules;
      } else {

      }
    };
    request.onerror = function() {};
    return request.send();
  };
  getSchedules();
  return setInterval(getSchedules, 5000);
})();
